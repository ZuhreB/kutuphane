<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<body>

<div th:fragment="contentFragment">
    <h2>Ödünç Kitap Ver</h2>
    <hr>

    <!-- Hata/Success mesajları için div -->
    <div id="message" class="alert" style="display: none;"></div>

    <form id="lendBookForm" class="styled-form">
        <div class="form-group">
            <label for="userId">Kullanıcı:</label>
            <select id="userId" name="userId" class="form-control" required>
                <option value="">Kullanıcı Seçin</option>
                <option th:each="user : ${users}"
                        th:value="${user.userID}"
                        th:text="${user.username}"></option>
            </select>
        </div>

        <div class="form-group">
            <label for="bookId">Kitap:</label>
            <select id="bookId" name="bookId" class="form-control" required>
                <option value="">Kitap Seçin</option>
                <option th:each="book : ${books}"
                        th:value="${book.bookID}"
                        th:text="${book.title}"></option>
            </select>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Ödünç Ver</button>
        </div>
    </form>

    <script th:inline="javascript">
        document.getElementById('lendBookForm').addEventListener('submit', async (e) => {
            e.preventDefault();
console.log("..............................................................................................");

            const formData = {
                userID: document.getElementById('userId').value,
                bookID: document.getElementById('bookId').value

            };

            try {
                const response = await fetch('/api/borrows/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.message || 'Ödünç verme işlemi başarısız');
                }

                showMessage('Kitap başarıyla ödünç verildi!', 'success');
                e.target.reset();
            } catch (error) {
                showMessage('Hata: ' + error.message, 'danger');
                console.error('Hata:', error);
            }
        });

        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `alert alert-${type}`;
            messageDiv.style.display = 'block';
        }
    </script>

    <style>
        .alert-success { background-color: #d4edda; color: #155724; }
        .alert-danger { background-color: #f8d7da; color: #721c24; }
    </style>
</div>

</body>
</html>