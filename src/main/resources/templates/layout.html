<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle} ?: 'Library Management System'">Library Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/main.css}" />
    <link rel="stylesheet" th:href="@{/css/admin.css}" />
    <link rel="stylesheet" th:href="@{/css/employee.css}" />
    <style>
        /* Ana CSS yapısı: Sayfa düzeni (grid) ve element konumlandırmaları */
        body {
            display: grid;
            grid-template-areas:
                "header header header"
                "nav article article"
                "nav footer footer";
            grid-template-rows: 80px 1fr 70px;
            grid-template-columns: 250px 1fr; /* Sidebar genişliği için ayarlandı */
            gap: 10px;
            height: 100vh;
            margin: 0;
            background-color: #f0f2f5; /* main.css body background ile uyumlu */
        }
        #pageHeader {
            grid-area: header;
            background-color: #ffffff; /* Navbar background ile uyumlu */
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky; /* Sayfa kaydığında üstte kalması için */
            top: 0;
            z-index: 99;
        }
        #mainArticle {
            grid-area: article;
            background-color: #fff; /* Konteyner background ile uyumlu */
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin: 0; /* Varsayılan kenar boşluğunu kaldır */
            overflow-y: auto; /* İçerik için kaydırmayı etkinleştir */
        }
        #mainNav {
            grid-area: nav;
            background-color: #1c1e21; /* Sidenav background ile uyumlu */
            padding-top: 60px; /* Header çakışmasını engellemek için ayarlandı */
            overflow-x: hidden;
            transition: 0.4s cubic-bezier(0.1, 0.7, 0.6, 1);
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }
        #pageFooter {
            grid-area: footer;
            background-color: #ffffff;
            padding: 1.2em;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.05);
            text-align: center;
            color: #606770;
        }

        /* Header içindeki yanmenü-btn için ayarlamalar */
        .header-content {
            display: flex;
            align-items: center;
        }
        .header-content .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1877f2;
            margin-left: 1rem; /* Butondan sonra boşluk */
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .user-info a {
            color: #d93025;
            text-decoration: none;
            font-weight: 600;
        }

        /* Yan menü (sabit sidebar) için stiller */
        #mainNav a {
            padding: 10px 15px 10px 32px;
            text-decoration: none;
            font-size: 22px;
            color: #a0a0a0;
            display: block;
            transition: 0.3s;
        }
        #mainNav a:hover {
            color: #ffffff;
        }

        /* Mobil uyumluluk için medya sorguları */
        @media all and (max-width: 768px) { /* Ayarlanmış kırılma noktası */
            body {
                grid-template-areas:
                    "header"
                    "nav"
                    "article"
                    "footer";
                grid-template-rows: 80px 250px 1fr 70px; /* Nav sabit yükseklik ve üst üste */
                grid-template-columns: 1fr;
            }
            #mainNav {
                width: 100%; /* Üst üste olduğunda nav tam genişlik */
                position: relative; /* Üst üste dizilme için göreceli konum */
                height: auto; /* İçeriğe göre yükseklik */
                padding-top: 0; /* Dolgu kaldır */
            }
            /* Küçük ekranlarda sabit sidebar'ı gizle */
            .sidenav {
                width: 0; /* Başlangıçta gizli */
                position: fixed; /* Geçiş için sabit tut */
                left: 0;
                top: 0;
            }
            .sidenav.open {
                width: 250px; /* Açıldığında göster */
            }
            #overlay {
                display: block; /* Küçük ekranlar için her zaman potansiyel olarak göster */
            }
            #pageHeader .yanmenü-btn {
                display: inline-block; /* Küçük ekranlarda geçiş düğmesini göster */
            }
        }

        /* Masaüstü görünümü için sidebar'ı gizle, mainNav sidebar olacak */
        .sidenav { display: none; }
        .overlay { display: none; }

        @media all and (min-width: 769px) {
            #pageHeader .yanmenü-btn {
                display: none; /* Büyük ekranlarda geçiş düğmesini gizle */
            }
        }
    </style>
</head>
<body>
<header id="pageHeader">
    <div class="header-content">
        <button class="yanmenü-btn" onclick="toggleNav()">
            <i class="yanmenü-icon fas fa-bars"></i>
        </button>
        <div class="logo">Kütüphane</div>
    </div>
    <div class="user-info">
        <span th:text="${loggedUser.firstName}">Kullanıcı</span>
        <a th:href="@{/logout}">Çıkış Yap</a>
    </div>
</header>
<nav id="mainNav">
    <div th:replace="${#strings.toUpperCase(loggedUser?.role) eq 'ADMIN'}
         ? ~{fragments/admin-sidebar :: admin-sidebar}
         : (${#strings.toUpperCase(loggedUser?.role) eq 'EMPLOYEE'}
            ? ~{fragments/employee-sidebar :: employee-sidebar}
            : ~{fragments/user-sidebar :: user-sidebar})"></div>
</nav>

<article id="mainArticle">
    <div th:replace="~{fragments/main-content :: contentFragment}"></div>
    <div th:replace="~{fragments/list-books-content :: contentFragment}"></div>
    <div th:replace="~{fragments/add-book-content :: contentFragment}"></div>
    <div th:replace="~{fragments/lend-book-form :: contentFragment}"></div>
    <div th:replace="~{fragments/list-borrowed :: contentFragment}"></div>
    <div th:replace="~{fragments/list-user :: contentFragment}"></div>
    <div th:replace="~{fragments/member-registration :: contentFragment}"></div>
    </article>

<footer id="pageFooter">
    &copy; 2025 Kütüphane Yönetim Sistemi. Tüm hakları saklıdır.
</footer>

<div id="overlay" class="overlay" onclick="toggleNav()"></div>

<div id="mySidenav" class="sidenav">
    <a href="javascript:void(0)" class="closebtn" onclick="toggleNav()">&times;</a>
    <div th:replace="${#strings.toUpperCase(loggedUser?.role) eq 'ADMIN'}
         ? ~{fragments/admin-sidebar :: admin-sidebar}
         : (${#strings.toUpperCase(loggedUser?.role) eq 'EMPLOYEE'}
            ? ~{fragments/employee-sidebar :: employee-sidebar}
            : ~{fragments/user-sidebar :: user-sidebar})"></div>
</div>

<script th:src="@{/js/main.js}"></script>
</body>
</html>